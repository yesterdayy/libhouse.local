$(function(){$(".current-city-wrap").click(function(){let content=$(".city-pick-modal");content.removeClass("d-none");let modal={title:"Выберите регион или город",content:content[0]};show_modal(modal)});init_header_filters();$(document).click(function(a){let elem=$(a.target).attr("rel")=="popover"?$(a.target):$(a.target).closest("[rel=popover]");if(elem.length===0&&!$(a.target).hasClass("popover")&&$(a.target).closest(".popover").length===0||elem.length>0&&$(".popover").length>1){$("[rel=popover]").not(elem).popover("hide")}})});function init_header_filters(){$(".adv-rent-type-popup").popover({content:$(".header-rent-types").html(),container:".adv-form-header",html:true,placement:"bottom",offset:"-5px 5px",sanitize:false});$(".adv-type-popup").popover({content:$(".header-types > div")[0],container:".adv-form-header",html:true,placement:"bottom",offset:"194px 5px",sanitize:false});$(".adv-floors-popup").popover({content:$(".header-floors ul")[0],container:".adv-form-header",html:true,placement:"bottom",offset:"64px 5px",sanitize:false});$(".adv-dop-type-popup").popover({content:$(".header-dop-types").html(),container:".adv-form-header",html:true,placement:"bottom",offset:"62px 5px",sanitize:false});$(document).on("click",".header-filter-simple-list:not(.with-checkboxes) li",function(){if(typeof $(this).attr("data-val")!=="undefined"){$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("input[type=hidden]").val($(this).attr("data-val"));$(this).toggleClass("active");$(this).closest(".popover").popover("hide")}});$(document).on("click",".header-filter-multi-list li",function(){$(this).toggleClass("active");var a=[];$("li.active",$(this).parent().parent()).each(function(){a.push($(this).attr("data-val"))});$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("input[type=hidden]").val(a)});$(document).on("click",".header-filter-simple-list.with-checkboxes > li",function(b){if(!$(b.target).is("input[type=checkbox]")&&!$(b.target).is("label")){$("input[type=checkbox]",this).prop("checked",!$("input[type=checkbox]",this).prop("checked"))}var a=[];$("input[type=checkbox]",$(this).parent()).each(function(){if($(this).prop("checked")){a.push($(this).closest("li").attr("data-val"))}});$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("input[type=hidden]").val(a)});$(".header-select2").select2({width:"100%",disabled:"readonly"});$(document).on("click",".popular-cities-pick li a",function(a){a.preventDefault();$.cookie("city",$(this).closest("li").attr("data-val"));$(".current-city").text($(this).closest("li").attr("data-val"));show_toast("Сохранено")});$(".header-address-input").autocomplete({serviceUrl:"/kladr/city_and_street",dataType:"json",paramName:"term",groupBy:"cat",minChars:3,containerClass:"autocomplete-suggestions header-address-autocomplete",onSearchStart:function(a){a.city=$("input[name=header_address_city]").val()},onSelect:function(a){$("input[name=header_address_city]").val(a.data.city_kladr);if("street_kladr" in a.data){$("input[name=header_address_street]").val(a.data.street_kladr)}else{$("input[name=header_address_street]").val(null)}}});autocomplete_close_listener(".header-address-input");$(".address-pick").autocomplete({serviceUrl:"/kladr/city",dataType:"json",paramName:"term",minChars:3,onSelect:function(a){$("input[name=header_address_city]").val(a.data.city_kladr);$.cookie("city",a.value);$.cookie("city_kladr",a.data.city_kladr);$(".current-city").text(a.value);show_toast("Сохранено")}});$(".address-pick").on("select2:select",function(){$.cookie("city",$(this).val());$(".current-city").text($(this).val());show_toast("Сохранено")})}function show_modal(a){if(typeof a!=="undefined"){if(a.hasOwnProperty("title")&&a.hasOwnProperty("content")){$("#success-form-modal .modal-title").text(a.title);$("#success-form-modal .modal-body").html(a.content);$("#success-form-modal .modal-footer").html("")}if(a.hasOwnProperty("buttons")){a.buttons=JSON.parse(a.buttons);if(a.buttons.length>0){a.buttons.forEach(function(b){$("#success-form-modal .modal-footer").append('<button type="button" class="btn'+(b.hasOwnProperty("class")?" "+b["class"]:"")+'" '+(b.hasOwnProperty("onclick")?'onclick="'+b.onclick+'"':"")+">"+(b.hasOwnProperty("text")?" "+b.text:"")+"</button>")})}}if(a.hasOwnProperty("title")&&a.hasOwnProperty("content")){$("#success-form-modal").modal("show");return true}}return false}function hide_modal(){$("#success-form-modal").modal("hide");return true}function show_toast(b){var a=$("#default-toast").clone();a.html(b);$(".toasts-wrap").append(a.removeClass("d-none").toast("show"))}function autocomplete_close_listener(a,b){$(a).blur(function(){var c=this;setTimeout(function(){if($(c).autocomplete().suggestions.length>0&&$(c).val().length>2&&$(c).autocomplete().selection==null){var e=$(c).val();var d=false;if(!d){$(c).autocomplete().onSelect(0);$(c).trigger("close")}}},300)})};