$(function(){$(".current-city-wrap").click(function(){let content=$(".city-pick-modal");content.removeClass("d-none");let modal={title:"Выберите регион или город",content:content[0]};show_modal(modal)});init_header_filters();$(document).click(function(a){let elem=$(a.target).attr("rel")=="popover"?$(a.target):$(a.target).closest("[rel=popover]");if(elem.length===0&&!$(a.target).hasClass("popover")&&$(a.target).closest(".popover").length===0||elem.length>0&&$(".popover").length>1){$("[rel=popover]").not(elem).popover("hide")}})});function init_header_filters(){$(".adv-rent-type-popup").popover({content:$(".header-rent-types").html(),container:".adv-form-header",html:true,placement:"bottom",offset:"-5px 9px",sanitize:false});$(".adv-type-popup").popover({content:$(".header-types > div").html(),container:".adv-form-header",html:true,placement:"bottom",offset:"194px 9px",sanitize:false});$(".adv-floors-popup").popover({content:$(".header-floors ul")[0],container:".adv-form-header",html:true,placement:"bottom",offset:"64px 9px",sanitize:false});$(".adv-dop-type-popup").popover({content:$(".header-dop-types").html(),container:".adv-form-header",html:true,placement:"bottom",offset:"62px 9px",sanitize:false});$(document).on("click",".header-filter-simple-list:not(.with-checkboxes):not(.custom-event) li",function(){if(typeof $(this).attr("data-val")!=="undefined"){var a="";if($(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").length>0){$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("input[type=hidden]").val($(this).attr("data-val"));a=$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("div[data-chars]")}else{$(this).closest(".d-none").parent().find("input[type=hidden]").val($(this).attr("data-val"));a=$(this).closest(".d-none").parent().find("div[data-chars]")}a.text($(this).attr("data-val").length>0?$(this).text().trim().substr(0,a.attr("data-chars")):a.attr("data-default-text"));$(this).toggleClass("active");$(this).closest(".popover").popover("hide")}});$(document).on("click",".header-filter-multi-list li",function(){$(this).toggleClass("active");var c=[];var b=[];$("li.active",$(this).parent().parent()).each(function(){c.push($(this).attr("data-val"));b.push($(this).text().trim())});var a="";if($(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").length>0){$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("input[type=hidden]").val(c);a=$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("div[data-chars]")}else{$(this).closest(".d-none").parent().find("input[type=hidden]").val(c);a=$(this).closest(".d-none").parent().find("div[data-chars]")}a.text(c.length>0?b.join(",").substr(0,a.attr("data-chars")):a.attr("data-default-text"))});$(document).on("click",".header-filter-simple-list.with-checkboxes > li",function(c){if(!$(c.target).is("input[type=checkbox]")&&!$(c.target).is("label")){$("input[type=checkbox]",this).prop("checked",!$("input[type=checkbox]",this).prop("checked"))}var b=[];var a=[];$("input[type=checkbox]",$(this).parent()).each(function(){if($(this).prop("checked")){b.push($(this).closest("li").attr("data-val"));a.push($(this).closest("li").text().trim())}});$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("input[type=hidden]").val(b);let text_elem=$(".adv-form-header div[aria-describedby="+$(this).closest(".popover").attr("id")+"]").find("div[data-chars]");text_elem.text(b.length>0?a.join(",").substr(0,text_elem.attr("data-chars")):text_elem.attr("data-default-text"))});$(".header-select2").select2({width:"100%",disabled:"readonly"});$(document).on("click",".popular-cities-pick li a",function(a){a.preventDefault();$.cookie("city",$(this).closest("li").attr("data-val"));$(".current-city").text($(this).closest("li").attr("data-val"));show_toast({status:"success",message:"Сохранено"});hide_modal()});$(".header-address-input").autocomplete({serviceUrl:"/kladr/city_and_street",dataType:"json",paramName:"term",groupBy:"cat",minChars:3,containerClass:"autocomplete-suggestions header-address-autocomplete",onSelect:function(a){$("input[name=city]",".adv-address-popup").val(a.data.city_name);if("street_kladr" in a.data){$("input[name=street]",".adv-address-popup").val(a.data.street_name)}else{$("input[name=street]",".adv-address-popup").val(null)}}});autocomplete_close_listener(".header-address-input");$(".address-pick").autocomplete({serviceUrl:"/kladr/city",dataType:"json",paramName:"term",minChars:3,onSelect:function(a){$("input[name=city]",".adv-address-popup").val(a.data.city_kladr);$.cookie("city",a.value);$.cookie("city_kladr",a.data.city_kladr);$(".current-city").text(a.value);show_toast({status:"success",message:"Сохранено"});hide_modal()}});$(".auth-login a").click(function(a){a.preventDefault();$(".auth-reset-back").click();$("#auth-form-modal form").trigger("reset");$("#auth-form-modal").modal("show")});$(".login-form, .register-form").submit(function(b){b.preventDefault();var a=this;$.ajax({type:"POST",url:$(this).attr("action"),data:$(this).serialize(),dataType:"JSON",success:function(c){$("input, textarea",a).removeClass("is-invalid");if("status" in c&&c.status=="success"){location.href=c.redirect}else{show_toast(c)}},error:function(d,e,c){$("input, textarea",a).removeClass("is-invalid");$("input, textarea",a).addClass("is-valid");if("errors" in d.responseJSON){tooltip_err(d.responseJSON.errors,a)}}})});$(".reset-pass").click(function(a){a.preventDefault();$(".auth-wrap").addClass("d-none");$(".reset-password-wrap").removeClass("d-none")});$(".reset-password-form").submit(function(b){b.preventDefault();var a=this;$.ajax({type:"POST",url:$(this).attr("action"),data:$(this).serialize(),dataType:"JSON",success:function(c){$("input, textarea",a).removeClass("is-invalid");if("status" in c&&c.status=="success"){show_toast(c)}},error:function(d,e,c){$("input, textarea",a).removeClass("is-invalid");if("errors" in d.responseJSON){tooltip_err(d.responseJSON.errors,a)}}})});$(".auth-reset-back").click(function(a){a.preventDefault();$(".auth-wrap").removeClass("d-none");$(".reset-password-wrap").addClass("d-none")});$(document).on("hidden.bs.toast",".toast",function(){$(this).toast("dispose");$(this).remove()});$(document).on("click",".realty-favorite-btn",function(){var b=$(this).attr("data-id");var a=this;$.ajax({type:"GET",url:"/favorite/"+b,dataType:"JSON",success:function(c){if("create" in c){$(a).addClass("active");$("span",a).text("В избранном")}else{if("remove" in c){$(a).removeClass("active");$("span",a).text("Добавить в избранное")}}show_toast(c)},error:function(d,e,c){show_toast({status:"error",message:"Произошла ошибка. Повторите попытку позже."})}})});$(document).on("click",".header-search:not(.active)",function(){var a=this;$(this).addClass("active");$("form",this).removeClass("d-none");setTimeout(function(){$("input",a).addClass("show")},10)});$(document).on("click",".header-search.active",function(){var a=this;$(this).addClass("active");$("form",this).removeClass("d-none");$("input",a).addClass("show")})}function show_modal(a){if(typeof a!=="undefined"){if(a.hasOwnProperty("title")&&a.hasOwnProperty("content")){$("#success-form-modal .modal-title").text(a.title);$("#success-form-modal .modal-body").html(a.content);$("#success-form-modal .modal-footer").html("")}if(a.hasOwnProperty("buttons")){a.buttons=JSON.parse(a.buttons);if(a.buttons.length>0){a.buttons.forEach(function(b){$("#success-form-modal .modal-footer").append('<button type="button" class="btn'+(b.hasOwnProperty("class")?" "+b["class"]:"")+'" '+(b.hasOwnProperty("onclick")?'onclick="'+b.onclick+'"':"")+">"+(b.hasOwnProperty("text")?" "+b.text:"")+"</button>")})}}if(a.hasOwnProperty("title")&&a.hasOwnProperty("content")){$("#success-form-modal").modal("show");return true}}return false}function hide_modal(){$("#success-form-modal").modal("hide");return true}function show_toast(b){var a=$(".default-toast").eq(0).clone();a.removeClass("default-toast");var c="";if(b.status=="success"){a.addClass("toast-success");c='<i class="lh-icon lh-icon-toast-success"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span></i>'}else{a.addClass("toast-error");c='<i class="lh-icon lh-icon-toast-error"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span><span class="path8"></span><span class="path9"></span><span class="path10"></span><span class="path11"></span><span class="path12"></span></i>'}a.html(c+" "+b.message);$(".toasts-wrap").append(a.removeClass("d-none").toast("show"))}function autocomplete_close_listener(a,b){$(a).blur(function(){var c=this;setTimeout(function(){if($(c).autocomplete().suggestions.length>0&&$(c).val().length>2&&$(c).autocomplete().selection==null){var e=$(c).val();var d=false;if(!d){$(c).autocomplete().onSelect(0);$(c).trigger("close")}}else{if($(c).autocomplete().selection==null){$(c).val(null);if($(c).closest(".form-group").find(".address_city").length>0){$(c).closest(".form-group").find(".address_city").val(null);$(c).closest(".form-group").find(".address_street").val(null)}}}},300)})}window.tooltip_err_timeout=null;function tooltip_err(c,a){$(".tooltip_err",a).popover("dispose");if(Object.keys(c).length){for(var b in c){if($("[name="+b+"]",a).length){if(typeof $("[name="+b+"]",a).data("bs.popover")!=="undefined"){$("[name="+b+"]",a).attr("data-content",c[b][0])}else{$("[name="+b+"]",a).attr("data-content",c[b][0]);$("[name="+b+"]",a).popover({container:a,html:true,placement:"right",sanitize:false,trigger:"manual",template:'<div class="popover tooltip_err" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',offset:"0 5px"})}$("[name="+b+"]",a).popover("show");$("[name="+b+"]",a).removeClass("is-valid").addClass("is-invalid")}}window.tooltip_err_timeout=setTimeout(function(){$(".tooltip_err",a).popover("dispose")},5000)}}function validation_toast(b){if("errors" in b.responseJSON){var a=[];for(var c in b.responseJSON.errors){a.push(b.responseJSON.errors[c][0])}show_toast({status:"error",message:a.join("<br>")})}};