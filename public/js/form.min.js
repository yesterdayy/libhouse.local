$(function(){$("input[name=trade_type]").change(function(){var c=$("input[name=duration]")[0];if($(this).val()=="1"){$("label[for=price]").text("Арендная плата");$(".comfort-add-wrap").show();switch($(this).closest("form").find('[name="user_realty_type"]:checked').val()){case"1":$("#comission").closest(".form-group").hide();break;case"2":$("#comission").closest(".form-group").show();break}$(c).closest(".form-group").show();$(c).closest(".btn-group-toggle").find("input[name=duration]").eq(0).click();toggle_commercy_fields(false)}else{$("label[for=price]").text("Цена");$(".comfort-add-wrap").hide();$("#comission").closest(".form-group").hide();$(c).closest(".form-group").hide();$(c).closest(".btn-group-toggle").find("input[name=duration]").last().prop("checked",true);$('input[name="info[with_communal]"]').closest(".form-group").hide();if($(this).closest("form").find('[name="user_realty_type"]:checked').val()=="2"&&$(this).closest("form").find('[name="rent_type"]:checked').val()=="1"){toggle_commercy_fields(true)}else{toggle_commercy_fields(false)}}hidden_field_set_null_value(".realty-create-form")});$("input[name=duration]").change(function(){if($(this).val()=="3"){$('input[name="info[with_communal]"]').closest(".form-group").hide()}else{$('input[name="info[with_communal]"]').closest(".form-group").show()}hidden_field_set_null_value(".realty-create-form")});$("input[name=user_realty_type]").change(function(){if($(this).closest("form").find('[name="trade_type"]:checked').val()=="1"){switch($(this).val()){case"1":$("#comission").closest(".form-group").hide();toggle_commercy_fields(false);break;case"2":$("#comission").closest(".form-group").show();toggle_commercy_fields(false);break}}else{if($(this).val()=="2"&&$(this).closest("form").find('[name="trade_type"]:checked').val()=="2"&&$(this).closest("form").find('[name="rent_type"]:checked').val()=="1"){toggle_commercy_fields(true)}else{toggle_commercy_fields(false)}}hidden_field_set_null_value(".realty-create-form")});$("input[name=rent_type]").change(function(){if($(this).closest("form").find('[name="trade_type"]:checked').val()=="2"){$("#comission").closest(".form-group").hide();switch($(this).val()){case"0":toggle_commercy_fields(false);break;case"1":if($(this).closest("form").find('[name="user_realty_type"]:checked').val()=="2"){toggle_commercy_fields(true)}else{toggle_commercy_fields(false)}break}}else{if($(this).closest("form").find('[name="user_realty_type"]:checked').val()=="2"){$("#comission").closest(".form-group").show()}toggle_commercy_fields(false)}hidden_field_set_null_value(".realty-create-form")});$(".add-video").click(function(){var e=$("input[name=youtube]");var c=e.val();if(c.length===0){alert("Нет видео, чтобы добавить.");return false}if(c.indexOf("youtube")!==-1&&c.indexOf("youtu.be")!==-1){alert("Видео должно быть с видеохостинга YouTube.");return false}var d="";d+='<div class="form-group row">';d+="<label>"+c+' <a href="#" class="realty-delete-video float-right">Удалить</a></label>';d+='<iframe width="560" height="315" src="'+c.replace("watch?v=","embed/").split("&")[0]+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>';d+='<input name="info[youtube][]" value="'+c.replace("watch?v=","embed/").split("&")[0]+'" type="hidden" />';d+="</div>";$(".realty-added-videos").append(d);e.val("")});$(document).on("click",".realty-delete-video",function(c){c.preventDefault();$(this).closest(".form-group").remove()});$(".address-select").autocomplete({serviceUrl:"/kladr/city_and_street",dataType:"json",paramName:"term",minChars:3,preventBadQueries:false,groupBy:"cat",onSelect:function(c){$("input[name=address_city]").val(c.data.city_kladr);if("street_kladr" in c.data){$("input[name=address_street]").val(c.data.street_kladr)}else{$("input[name=address_street]").val(null)}}});autocomplete_close_listener(".address-select");$(document).on("click",".set-main-photo",function(){let index=$(this).closest(".dz-preview").index();$(this).closest(".dropzone-wrap").prepend($(this).closest(".dz-preview"));$(this).closest(".dropzone-wrap").find(".dz-default.dz-message").after($(this).closest(".dropzone-wrap").find("input[type=hidden]").eq(index))});var b=$(".dropzone-wrap").dropzone({thumbnailWidth:400,thumbnailHeight:400,dictDefaultMessage:"Добавить фото",previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <ul class="dz-details"><li class="set-main-photo">Сделать главной</li></ul>\n</div>',url:"/upload/photo",maxFiles:8,maxFilesize:10,acceptedFiles:".jpg, .png, .gif",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},init:function(){if(typeof window.realty_photos!=="undefined"&&window.realty_photos.length>0){var c=this;window.realty_photos.forEach(function(d){var e={name:d.original_name,size:d.size,type:d.mime};c.emit("addedfile",e);c.emit("success",e);c.emit("thumbnail",e,d.thumbnails["slide-thumb"]);$(c.element).append('<input type="hidden" name="photos[]" value="'+d.id+'" />')});$(this.element).closest("form").find(".add-realty").prop("disabled",false);this.on("maxfilesexceeded",function(d){this.removeFile(d)})}else{}},queuecomplete:function(){$(this.element).closest("form").find(".add-realty").prop("disabled",false)},success:function(c){if(typeof c!=="undefined"&&c.hasOwnProperty("xhr")){let result=JSON.parse(c.xhr.response);let file_id=result.id;$(this.element).append('<input type="hidden" name="'+$(this.element).attr("data-name")+'" value="'+file_id+'" />')}},addedfile:function a(f){var j=this;$(this.element).closest("form").find(".add-realty").prop("disabled",true);if(this.element===this.previewsContainer){this.element.classList.add("dz-started")}if(this.previewsContainer){f.previewElement=Dropzone.createElement(this.options.previewTemplate.trim());f.previewTemplate=f.previewElement;this.previewsContainer.prepend(f.previewElement);$(".dz-message",this.element).css({display:"inline-block",margin:"15px"});for(var r=f.previewElement.querySelectorAll("[data-dz-name]"),k=true,p=0,r=k?r:r[Symbol.iterator]();;){var d;if(k){if(p>=r.length){break}d=r[p++]}else{p=r.next();if(p.done){break}d=p.value}var e=d;e.textContent=f.name}for(var q=f.previewElement.querySelectorAll("[data-dz-size]"),i=true,n=0,q=i?q:q[Symbol.iterator]();;){if(i){if(n>=q.length){break}e=q[n++]}else{n=q.next();if(n.done){break}e=n.value}e.innerHTML=this.filesize(f.size)}if(this.options.addRemoveLinks){f._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>");f.previewElement.appendChild(f._removeLink)}var h=function h(s){s.preventDefault();s.stopPropagation();if(f.status===Dropzone.UPLOADING){return Dropzone.confirm(j.options.dictCancelUploadConfirmation,function(){return j.removeFile(f)})}else{if(j.options.dictRemoveFileConfirmation){return Dropzone.confirm(j.options.dictRemoveFileConfirmation,function(){return j.removeFile(f)})}else{return j.removeFile(f)}}};for(var o=f.previewElement.querySelectorAll("[data-dz-remove]"),g=true,m=0,o=g?o:o[Symbol.iterator]();;){var c;if(g){if(m>=o.length){break}c=o[m++]}else{m=o.next();if(m.done){break}c=m.value}var l=c;l.addEventListener("click",h)}}}})});function toggle_commercy_fields(a){if(a){$(".house-classes").show();$('input[name="info[floor]"]').closest(".form-group").hide();$('input[name="info[floors]"]').closest(".form-group").hide();$('input[name="info[square_common]"]').closest(".form-group").find("label").text("Площадь");$('input[name="info[square_living]"]').closest(".form-group").hide();$('input[name="info[square_kitchen]"]').closest(".form-group").hide();$('input[name="info[with_communal]"]').closest(".form-group").hide();$(".comfort-add-wrap").hide();$(".room_type").closest(".form-group").hide();$('input[name="title"]').closest(".form-group").show();if($(".last-realty-add-wrap").html().length>0){$(".commercy-info-wrap").html($(".last-realty-add-wrap").html());$(".last-realty-add-wrap").html("")}}else{$(".house-classes").hide();$('input[name="info[floor]"]').closest(".form-group").show();$('input[name="info[floors]"]').closest(".form-group").show();$('input[name="info[square_common]"]').closest(".form-group").find("label").text("Общая площадь");$('input[name="info[square_living]"]').closest(".form-group").show();$('input[name="info[square_kitchen]"]').closest(".form-group").show();$('input[name="info[with_communal]"]').closest(".form-group").show();$(".room_type").closest(".form-group").show();$('input[name="title"]').closest(".form-group").hide();if($(".commercy-info-wrap").html().length>0){$(".last-realty-add-wrap").html($(".commercy-info-wrap").html());$(".commercy-info-wrap").html("")}}}function hidden_field_set_null_value(a){setTimeout(function(){$(".form-group:hidden input:not([type=radio]):not([type=checkbox])",a).val(null);$(".form-group:hidden input[type=radio], .form-group:hidden input[type=checkbox]",a).prop("checked",false);$(".form-group:hidden input[type=radio]",a).each(function(){if($(this).parent().hasClass("btn")){$(this).parent().removeClass("active")}});$(".form-group:hidden select",a).val(null).change()},50)};