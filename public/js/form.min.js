$(function(){$("input[name=trade_type]").change(function(){var c=$("input[name=duration]")[0];if($(this).val()=="1"){$(c).closest(".form-group").removeClass("d-none");$(c).closest(".btn-group-toggle").find("input[name=duration]").eq(0).click()}else{$(c).closest(".form-group").addClass("d-none");$(c).closest(".btn-group-toggle").find("input[name=duration]").last().prop("checked",true)}});$(".add-video").click(function(){var e=$("input[name=youtube]");var c=e.val();if(c.length===0){alert("Нет видео, чтобы добавить.");return false}if(c.indexOf("youtube")!==-1&&c.indexOf("youtu.be")!==-1){alert("Видео должно быть с видеохостинга YouTube.");return false}var d="";d+='<div class="form-group row">';d+="<label>"+c+' <a href="#" class="realty-delete-video float-right">Удалить</a></label>';d+='<iframe width="560" height="315" src="'+c.replace("watch?v=","embed/").split("&")[0]+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>';d+='<input name="info[youtube][]" value="'+c.replace("watch?v=","embed/").split("&")[0]+'" type="hidden" />';d+="</div>";$(".realty-added-videos").append(d);e.val("")});$(document).on("click",".realty-delete-video",function(c){c.preventDefault();$(this).closest(".form-group").remove()});$(".address-select").autocomplete({serviceUrl:"/kladr/street_with_city",dataType:"json",paramName:"term",minChars:3,onSearchStart:function(c){c.city=$("input[name=address_city]").val()},onSelect:function(c){$("input[name=address_city]").val(c.data.city_kladr);if("street_kladr" in c.data){$("input[name=address_street]").val(c.data.street_kladr)}else{$("input[name=address_street]").val(null)}}});autocomplete_close_listener(".address-select");$(document).on("click",".set-main-photo",function(){let index=$(this).closest(".dz-preview").index();$(this).closest(".dropzone-wrap").prepend($(this).closest(".dz-preview"));$(this).closest(".dropzone-wrap").find(".dz-default.dz-message").after($(this).closest(".dropzone-wrap").find("input[type=hidden]").eq(index))});var b=$(".dropzone-wrap").dropzone({thumbnailWidth:400,thumbnailHeight:400,dictDefaultMessage:"Добавить фото",previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <ul class="dz-details"><li class="set-main-photo">Сделать главной</li></ul>\n</div>',url:"/upload/photo",maxFiles:8,maxFilesize:10,acceptedFiles:".jpg, .png, .gif",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},init:function(){if(typeof window.realty_photos!=="undefined"&&window.realty_photos.length>0){var c=this;window.realty_photos.forEach(function(d){var e={name:d.original_name,size:d.size,type:d.mime};c.emit("addedfile",e);c.emit("success",e);c.emit("thumbnail",e,d.thumbnails["slide-thumb"]);$(c.element).append('<input type="hidden" name="photos[]" value="'+d.id+'" />')});this.on("maxfilesexceeded",function(d){this.removeFile(d)})}else{}},success:function(c){if(typeof c!=="undefined"&&c.hasOwnProperty("xhr")){let result=JSON.parse(c.xhr.response);let file_id=result.id;$(this.element).append('<input type="hidden" name="'+$(this.element).attr("data-name")+'" value="'+file_id+'" />')}},addedfile:function a(f){var j=this;if(this.element===this.previewsContainer){this.element.classList.add("dz-started")}if(this.previewsContainer){f.previewElement=Dropzone.createElement(this.options.previewTemplate.trim());f.previewTemplate=f.previewElement;this.previewsContainer.prepend(f.previewElement);$(".dz-message",this.element).css({display:"inline-block",margin:"15px"});for(var r=f.previewElement.querySelectorAll("[data-dz-name]"),k=true,p=0,r=k?r:r[Symbol.iterator]();;){var d;if(k){if(p>=r.length){break}d=r[p++]}else{p=r.next();if(p.done){break}d=p.value}var e=d;e.textContent=f.name}for(var q=f.previewElement.querySelectorAll("[data-dz-size]"),i=true,n=0,q=i?q:q[Symbol.iterator]();;){if(i){if(n>=q.length){break}e=q[n++]}else{n=q.next();if(n.done){break}e=n.value}e.innerHTML=this.filesize(f.size)}if(this.options.addRemoveLinks){f._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>");f.previewElement.appendChild(f._removeLink)}var h=function h(s){s.preventDefault();s.stopPropagation();if(f.status===Dropzone.UPLOADING){return Dropzone.confirm(j.options.dictCancelUploadConfirmation,function(){return j.removeFile(f)})}else{if(j.options.dictRemoveFileConfirmation){return Dropzone.confirm(j.options.dictRemoveFileConfirmation,function(){return j.removeFile(f)})}else{return j.removeFile(f)}}};for(var o=f.previewElement.querySelectorAll("[data-dz-remove]"),g=true,m=0,o=g?o:o[Symbol.iterator]();;){var c;if(g){if(m>=o.length){break}c=o[m++]}else{m=o.next();if(m.done){break}c=m.value}var l=c;l.addEventListener("click",h)}}}})});